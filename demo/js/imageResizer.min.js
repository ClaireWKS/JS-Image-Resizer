var ImageResizer;(function(d){var f={maxWidth:500,maxHeight:500,resize:true,jpgQuality:0.9,returnFileObject:true,upscale:false,debug:false,renameFile:true};function e(j,i,h){if(!Modernizr.blobconstructor){if(i.debug){console.info("Blob constructor not supported by this browser. Can't resize or compress image.")}h(j);return}if(!Modernizr.canvas){if(i.debug){console.info("Canvas 2D drawing not supported by this browser. Can't resize or compress image.")}h(j);return}if(i.debug){console.log("Processing image: '"+j.name+"")}var k=c({},f,i);b(k);var g=document.createElement("img");g.onload=function(){var n=g.width;var v=g.height;var t=n;var s=v;var r=false;var x;if(k.resize){if(n>v){if(n>k.maxWidth||k.upscale){v=Math.round(v*k.maxWidth/n);n=k.maxWidth;r=true}}else{if(v>k.maxHeight||k.upscale){n=Math.round(n*k.maxHeight/v);v=k.maxHeight;r=true}}}if(r||k.jpgQuality!=1){var o=document.createElement("canvas");var w=o.getContext("2d");o.width=n;o.height=v;w.drawImage(g,0,0,n,v);var p=o.toDataURL("image/jpeg",k.jpgQuality);var l=a(p);if(i.debug){console.log("Setting jpeg-quality to: "+k.jpgQuality);console.log((r?"Resizing from "+t+"x"+s+"px to "+n+"x"+v+"px":"Resizing not required. Image smaller than max dimensions or resizing disabled."))}if(Modernizr.filesystem&&k.returnFileObject){var q;if(k.renameFile){var m=j.name.replace(/\.[^/.]+$/,"");q=m+(r?"_resized":"")+(k.jpgQuality!=1?"_compressed":"")+".jpg"}else{q=j.name}if(i.debug){console.log("Renamed file from '"+j.name+"' to '"+q+"'")}var u=new File([l],q,{type:l.type,lastModified:(new Date()).getTime()});if(i.debug){console.log("Returning File object: \n  name: "+u.name+"\n  lastModified: "+u.lastModifiedDate+"\n  size: "+u.size+"\n  type: "+u.type)}h(u)}else{if(!Modernizr.filesystem&&i.debug){console.info("Browser doesn't support File API")}if(i.debug){console.log("Returning Blob object:\n  size: "+l.size+"\n  type: "+l.type)}h(l)}}else{if(i.debug){console.log("Image smaller than max-dimensions")}h(j)}};g.src=window.URL.createObjectURL(j)}d.resizeImage=e;function a(n){var g=";base64,";if(n.indexOf(g)==-1){var m=n.split(",");var o=m[0].split(":")[1];var h=decodeURIComponent(m[1]);return new Blob([h],{type:o})}var m=n.split(g);var o=m[0].split(":")[1];var h=window.atob(m[1]);var l=h.length;var k=new Uint8Array(l);for(var j=0;j<l;++j){k[j]=h.charCodeAt(j)}return new Blob([k],{type:o})}function c(l,k,g){for(var j=1;j<arguments.length;j++){for(var h in arguments[j]){if(arguments[j].hasOwnProperty(h)){arguments[0][h]=arguments[j][h]}}}return arguments[0]}function b(g){if(g.jpgQuality<0||g.jpgQuality>1){console.error("Option jpgQuality must be between 0 and 1")}}})(ImageResizer||(ImageResizer={}));