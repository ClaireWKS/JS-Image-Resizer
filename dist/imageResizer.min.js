var ImageResizer;(function(d){var g={maxWidth:500,maxHeight:500,resize:true,sharpen:0.1,jpgQuality:0.9,returnFileObject:true,upscale:false,debug:false,renameFile:true};function f(k,j,i){if(!Modernizr.blobconstructor){if(j.debug){console.info("Blob constructor not supported by this browser. Can't resize or compress image.")}i(k);return}if(!Modernizr.canvas){if(j.debug){console.info("Canvas 2D drawing not supported by this browser. Can't resize or compress image.")}i(k);return}if(j.debug){console.log("Processing image: '"+k.name+"'")}var l=c({},g,j);b(l);var h=document.createElement("img");h.onload=function(){var p=h.width;var y=h.height;var w=p;var u=y;var t=false;var B;if(l.resize){if(p>y){if(p>l.maxWidth||l.upscale){y=Math.round(y*l.maxWidth/p);p=l.maxWidth;t=true}}else{if(y>l.maxHeight||l.upscale){p=Math.round(p*l.maxHeight/y);y=l.maxHeight;t=true}}}if(t||l.jpgQuality!=1){var q=document.createElement("canvas");var z=q.getContext("2d");q.width=p;q.height=y;var v;if(p>y){v=Math.ceil(Math.log(h.width/p)/Math.log(2))}else{v=Math.ceil(Math.log(h.height/y)/Math.log(2))}console.log("Down-scaling-steps needed: "+v);console.log("Image: "+h.width);console.log("Goal:  "+p);if(v>1){var o=document.createElement("canvas"),A=o.getContext("2d");o.width=h.width*0.5;o.height=h.height*0.5;A.drawImage(h,0,0,o.width,o.height);console.log("Final: "+o.width);z.drawImage(o,0,0,o.width,o.height,0,0,q.width,q.height)}else{z.drawImage(h,0,0,p,y)}if(l.sharpen>0){if(j.debug){console.log("Sharpening image "+(l.sharpen*100)+"%")}e(z,q.width,q.height,l.sharpen)}var r=q.toDataURL("image/jpeg",l.jpgQuality);var m=a(r);if(j.debug){console.log("Setting jpeg-quality to: "+l.jpgQuality);console.log((t?"Resizing from "+w+"x"+u+"px to "+p+"x"+y+"px":"Resizing not required. Image smaller than max dimensions or resizing disabled."))}if(Modernizr.filesystem&&l.returnFileObject){var s;if(l.renameFile){var n=k.name.replace(/\.[^/.]+$/,"");s=n+(t?"_resized":"")+(l.jpgQuality!=1?"_compressed":"")+".jpg"}else{s=k.name}if(j.debug){console.log("Renamed file from '"+k.name+"' to '"+s+"'")}var x=new File([m],s,{type:m.type,lastModified:(new Date()).getTime()});if(j.debug){console.log("Finished processing. Returning File object: \n  name: "+x.name+"\n  lastModified: "+x.lastModifiedDate+"\n  size: "+x.size+"\n  type: "+x.type)}i(x)}else{if(!Modernizr.filesystem&&j.debug){console.info("Browser doesn't support File API")}if(j.debug){console.log("Finished processing. Returning Blob object:\n  size: "+m.size+"\n  type: "+m.type)}i(m)}}else{if(j.debug){console.log("Image smaller than max-dimensions")}i(k)}};h.src=window.URL.createObjectURL(k)}d.resizeImage=f;function e(v,o,E,p){var G=[0,-1,0,-1,5,-1,0,-1,0],q=Math.round(Math.sqrt(G.length)),B=(q*0.5)|0,K=v.createImageData(o,E),H=K.data,C=v.getImageData(0,0,o,E).data,l=E;while(l--){var m=o;while(m--){var s=l,u=m,z=(l*o+m)*4,t=0,F=0,I=0,J=0;for(var j=0;j<q;j++){for(var k=0;k<q;k++){var A=s+j-B;var D=u+k-B;if(A>=0&&A<E&&D>=0&&D<o){var n=(A*o+D)*4;var i=G[j*q+k];t+=C[n]*i;F+=C[n+1]*i;I+=C[n+2]*i;J+=C[n+3]*i}}}H[z]=t*p+C[z]*(1-p);H[z+1]=F*p+C[z+1]*(1-p);H[z+2]=I*p+C[z+2]*(1-p);H[z+3]=C[z+3]}}v.putImageData(K,0,0)}function a(o){var h=";base64,";if(o.indexOf(h)==-1){var n=o.split(",");var p=n[0].split(":")[1];var j=decodeURIComponent(n[1]);return new Blob([j],{type:p})}var n=o.split(h);var p=n[0].split(":")[1];var j=window.atob(n[1]);var m=j.length;var l=new Uint8Array(m);for(var k=0;k<m;++k){l[k]=j.charCodeAt(k)}return new Blob([l],{type:p})}function c(m,l,h){for(var k=1;k<arguments.length;k++){for(var j in arguments[k]){if(arguments[k].hasOwnProperty(j)){arguments[0][j]=arguments[k][j]}}}return arguments[0]}function b(h){if(h.jpgQuality<0||h.jpgQuality>1){console.error("Option jpgQuality must be between 0 and 1")}if(h.sharpen<0||h.sharpen>1){console.error("Option sharpen must be between 0 and 1")}}})(ImageResizer||(ImageResizer={}));