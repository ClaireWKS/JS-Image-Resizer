var ImageResizer;(function(d){var g={maxWidth:500,maxHeight:500,resize:true,sharpen:0.15,jpgQuality:0.9,returnFileObject:true,upscale:false,debug:false,renameFile:true};function f(k,j,i){if(!Modernizr.blobconstructor){if(j.debug){console.info("Blob constructor not supported by this browser. Can't resize or compress image.")}i(k);return}if(!Modernizr.canvas){if(j.debug){console.info("Canvas 2D drawing not supported by this browser. Can't resize or compress image.")}i(k);return}if(j.debug){console.log("Processing image: '"+k.name+"'")}var l=c({},g,j);b(l);var h=document.createElement("img");h.onload=function(){var u=h.width;var s=h.height;var A=u;var B=s;var z=false;if(l.resize){if(u>s){if(u>l.maxWidth||l.upscale){s=Math.round(s*l.maxWidth/u);u=l.maxWidth;z=true}}else{if(s>l.maxHeight||l.upscale){u=Math.round(u*l.maxHeight/s);s=l.maxHeight;z=true}}}if(z||l.jpgQuality!=1){var n=document.createElement("canvas");var w=n.getContext("2d");n.width=u;n.height=s;var y;if(u>s){y=Math.ceil(Math.log(h.width/u)/Math.log(2))}else{y=Math.ceil(Math.log(h.height/s)/Math.log(2))}if(y>1){var v=document.createElement("canvas"),o=v.getContext("2d");var t,r;v.width=t=h.width*0.5;v.height=r=h.height*0.5;o.drawImage(h,0,0,v.width,v.height);for(var x=2;x<y;x++){t*=0.5;r*=0.5;o.drawImage(v,0,0,v.width*0.5,v.height*0.5)}w.drawImage(v,0,0,t,r,0,0,n.width,n.height)}else{w.drawImage(h,0,0,u,s)}if(l.sharpen>0){if(j.debug){console.log("Sharpening image "+(l.sharpen*100)+"%")}e(w,n.width,n.height,l.sharpen)}var p=n.toDataURL("image/jpeg",l.jpgQuality);var m=a(p);if(j.debug){console.log("Setting jpeg-quality to: "+l.jpgQuality);console.log((z?"Resizing from "+A+"x"+B+"px to "+u+"x"+s+"px":"Resizing not required. Image smaller than max dimensions or resizing disabled."))}if(Modernizr.filesystem&&l.returnFileObject){var C;if(l.renameFile){var D=k.name.replace(/\.[^/.]+$/,"");C=D+(z?"_resized":"")+(l.jpgQuality!=1?"_compressed":"")+".jpg"}else{C=k.name}if(j.debug){console.log("Renamed file from '"+k.name+"' to '"+C+"'")}var q=new File([m],C,{type:m.type,lastModified:(new Date()).getTime()});if(j.debug){console.log("Finished processing. Returning File object: \n  name: "+q.name+"\n  lastModified: "+q.lastModifiedDate+"\n  size: "+q.size+"\n  type: "+q.type)}i(q)}else{if(!Modernizr.filesystem&&j.debug){console.info("Browser doesn't support File API")}if(j.debug){console.log("Finished processing. Returning Blob object:\n  size: "+m.size+"\n  type: "+m.type)}i(m)}}else{if(j.debug){console.log("Image smaller than max-dimensions")}i(k)}};h.src=window.URL.createObjectURL(k)}d.resizeImage=f;function e(v,o,E,p){var G=[0,-1,0,-1,5,-1,0,-1,0],q=Math.round(Math.sqrt(G.length)),B=(q*0.5)|0,K=v.createImageData(o,E),H=K.data,C=v.getImageData(0,0,o,E).data,l=E;while(l--){var m=o;while(m--){var s=l,u=m,z=(l*o+m)*4,t=0,F=0,I=0,J=0;for(var j=0;j<q;j++){for(var k=0;k<q;k++){var A=s+j-B;var D=u+k-B;if(A>=0&&A<E&&D>=0&&D<o){var n=(A*o+D)*4;var i=G[j*q+k];t+=C[n]*i;F+=C[n+1]*i;I+=C[n+2]*i;J+=C[n+3]*i}}}H[z]=t*p+C[z]*(1-p);H[z+1]=F*p+C[z+1]*(1-p);H[z+2]=I*p+C[z+2]*(1-p);H[z+3]=C[z+3]}}v.putImageData(K,0,0)}function a(o){var h=";base64,";if(o.indexOf(h)==-1){var n=o.split(",");var p=n[0].split(":")[1];var j=decodeURIComponent(n[1]);return new Blob([j],{type:p})}var n=o.split(h);var p=n[0].split(":")[1];var j=window.atob(n[1]);var m=j.length;var l=new Uint8Array(m);for(var k=0;k<m;++k){l[k]=j.charCodeAt(k)}return new Blob([l],{type:p})}function c(m,l,h){for(var k=1;k<arguments.length;k++){for(var j in arguments[k]){if(arguments[k].hasOwnProperty(j)){arguments[0][j]=arguments[k][j]}}}return arguments[0]}function b(h){if(h.jpgQuality<0||h.jpgQuality>1){console.error("Option jpgQuality must be between 0 and 1")}if(h.sharpen<0||h.sharpen>1){console.error("Option sharpen must be between 0 and 1")}}})(ImageResizer||(ImageResizer={}));